<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/night.css"> 
		<link rel="stylesheet" href="dist/custom.css"> 

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/dracula.css">
		<script src="plugin/leader-line.min.js"></script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<div style="height:100vh;display:flex;flex-direction: column;justify-content: space-between;">
						<div style="background: url('img/fundo.png'); background-repeat: no-repeat; background-size: cover;width:100%;height:70%">
							<div style="height:100%;display: flex;flex-direction: column; justify-content: space-between;">
								<div style="display:flex;flex-direction: row; justify-content: space-between;margin:30px 30px;">
									<span style="font-size:24pt">CPVBCDD - Banco de Dados 1</span>
									<span style="font-size:24pt">Aula 14</span>
								</div>
								<h3 style="margin: 0 30px; margin-bottom:60px; align-content: end; justify-self:flex-end">
									CRUD com Banco de Dados
								</h3>
							</div>
						</div>
						<div style="display:flex;flex-direction:row;margin-bottom:40px;justify-content: space-between;margin-inline:30px">
							<div style="text-align: left;font-size:24pt">
								<p>Prof. Caio Hamamura</p>
								<p>hamamura.caio@ifsp.edu.br</p>
							</div>
							<img src="img/Artboard 1 copy 2.png" alt="">
						</div>
					</div>	
				</section>



				<section>
					<img src="img/CRUD API.svg" alt="" style="height:100vh;">	
				</section>




				<section data-transition="zoom-in slide-out">
					<style>:root { --code-font-size: 15.8px; }</style>
					<div class="column" style="height:100vh;">
						<div class="row" style="justify-content: center;">
							<img src="img/olapessoa.png" width="600" class="fragment" data-fragment-index="3" alt="">
						</div>
						<div class="row">
							<div class="column">
								<img src="img/python.png" alt="" style="margin:0">
								<div id="start-highlight" data-fragment-index="1" class="fragment" style="position: absolute;display: block;
								width:370px;height: 25px; 
								border-radius: 999px;
								margin-top:135px;margin-left:35px;
								z-index: 1;background-color: #FFFF0020;"></div>
								<pre style="margin:0px;min-width:437px;font-size:var(--code-font-size)"><code class="python" data-trim data-no-escape>
									
@app.route('/')
def inicio():
    return render_template(
		'index.j2',
		variavel_enviada_pelo_app_py='Pessoa'
	)
									</code></pre>
						</div>
						<div class="column" style="justify-content: start;">
							<img src="img/jinja.png" alt="" style="margin:0">
							<div class="fragment" id="end-highlight" data-fragment-index="1" style="position: absolute;display: block;width:310px;height: 30px; border-radius: 999px;margin-top:74px;margin-left:80px;z-index: 1;background-color: #FFFF0020;"></div>
							<pre style="margin:0px;min-width:476px;font-size:var(--code-font-size)"><code class="jinja" data-trim data-no-escape>
&lt;body&gt;
&lt;h1&gt;Olá {{variavel_enviada_pelo_app_py }}!&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;
								</code></pre>
					</div>
						
						</div>
				</div>
				</section>


				<section data-transition="slide-in zoom-out" data-background-transition="zoom-out">
					<div style="height:100vh;display:flex;flex-direction: column;justify-content: space-between;">
						<div style="background: url('img/fundo.png'); background-repeat: no-repeat; background-size: cover;width:100%;height:70%">
							<div style="height:100%;display: flex;flex-direction: column; justify-content: space-between;">
								<div></div>
								<h3 style="text-align:left;margin: 0 30px; margin-bottom:60px; align-content: end; justify-self:flex-end">
									<p style="margin:0;color:tomato">CRUD</p>
									<p style="margin:0"><span style="color:tomato">C</span>: CREATE (criar)</p>
									<p style="margin:0"><span style="color:tomato">R</span>: READ (ler)</p> 
									<p style="margin:0"><span style="color:tomato">U</span>: UPDATE (atualizar)</p>
									<p style="margin:0"><span style="color:tomato">D</span>: DELETE (deletar)</p>
								</h3>
							</div>
						</div>
						<div style="display:flex;flex-direction:row;margin-bottom:100px;justify-content: space-between;margin-inline:30px">
							<div style="text-align: left;font-size:24pt"> 
							</div>
							<!-- <p>Conteudo</p> -->
						</div>
					</div>	
				</section>

				<section data-transition="fade-out" data-background-transition="fade-out">
					<img src="/img/tarefas.png" alt="Imagem do aplicativo">
					<div class="fragment current-visible fade-out" 
						data-fragment-index="1"
						style="position: absolute;display: block;
						width:510px;
						height: 240px; border-radius: 21px;
						margin-top:-400px;
						margin-left:130px; z-index: 1;background-color: #FFFF0050;
						align-content: center;
						color: black;
						font-weight: bolder;">
						LER (Read)</div>
					<div class="fragment fade-in current-visible"
					data-fragment-index="2"
						style="position: absolute;display: block;
						width:660px;
						height: 80px; border-radius: 21px;
						margin-top:-120px;
						margin-left:130px; z-index: 1;background-color: #FFFF0050;
						align-content: center;
						color: black;
						font-weight: bolder;">
						CRIAR (Create)</div>
					<div class="fragment fade-in fade-out current-visible"
					data-fragment-index="3"
						style="position: absolute;display: block;
						width:70px;
						height: 130px; border-radius: 21px;
						margin-top:-300px;
						margin-left:681px; z-index: 1;background-color: #FFFF0050;
						align-content: center;
						color: black;
						font-weight: bolder;">
						EDITAR (Edit)</div>
						<div class="fragment fade-in"
						data-fragment-index="4"
						style="position: absolute;display: block;
						width:70px;
						height: 130px; border-radius: 21px;
						margin-top:-300px;
						margin-left:738px; z-index: 1;background-color: #ff634780; 
						align-content: center; 
						color: white;
						text-shadow: #000 1px 1px 1px;
						font-weight: bolder;">
						APAGAR (Delete)</div>
				</section>


				<section data-markdown>
					<textarea data-template>
					<!-- .slide: data-transition-background='convex-in zoom-out' data-transition="convex-in zoom-out" -->
					## Lendo (Read) com Python Flask
					1. Vamos começar realizando criando um banco de dados aula14
					1. Vamos criar uma tabela de afazeres
					1. Inserir dados
					2. Vamos criar uma rota para listar os afazeres
					3. Template de afazeres
					
					---
					## 1. Criando o banco de dados
						CREATE DATABASE IF NOT EXISTS aula14;
						
						USE aula14;
						
						CREATE TABLE IF NOT EXISTS afazeres (
							id INT PRIMARY KEY AUTO_INCREMENT,
							conteudo VARCHAR(100) NOT NULL
						);

						INSERT INTO afazeres (conteudo) 
						VALUES ('Aprender a integrar Banco de Dados na Web!');

					---
					## 2. Criando uma rota para listar os afazeres	
						from sqlalchemy import create_engine, text

						engine = create_engine('mysql+pymysql://root@localhost:3308/aula14')

						def consulta(sql):
							with engine.connect() as conn:
								result = conn.execute(text(sql))
								conn.commit()
								return result

						@app.route('/')
						def listar_afazeres():
							afazeres = consulta('SELECT * FROM afazeres').mappings().all()
							return render_template('index.j2', afazeres=afazeres)

					---
					<!-- .slide: data-transition-background='zoom-in' data-transition="zoom-in fade-out" -->
					## 3. Template de afazeres
						<h1>Lista de afazeres</h1>
						{% for afazer in afazeres %}
							<hr> <!-- Cria linha horizontal -->
							{{ afazer.conteudo }}
						{% endfor %}
						<hr>

					---
					<!-- .slide: data-transition-background='convex-in zoom-out' data-transition="convex-in zoom-out" -->
					## Criando (Create) com Python Flask
					1. Vamos adicionar um formulário no template para criar o afazer
					2. Em seguida vamos criar uma rota para criar o afazer

					---
					## 1. Adicionando um formulário no template
						<form method="POST" action="/criar">
							<input type="text" name="conteudo">
							<button type="submit">Criar</button>
						</form>
					
					---
					<!-- .slide: data-transition-background='zoom-in' data-transition="zoom-in fade-out" -->					
					## 2. Criando uma rota para criar o afazer
						@app.route('/criar', methods=['POST'])
						def criar_afazer():
							conteudo = request.form['conteudo']
							consulta(f'INSERT INTO afazeres (conteudo) VALUES ("{conteudo}")')
							return redirect('/')

					---
					
					<!-- .slide: data-transition-background='convex-in zoom-out' data-transition="convex-in zoom-out" -->
					## Apagando (Delete) com Python Flask
					1. Vamos criar um botão para apagar
					2. Vamos criar uma rota para apagar o afazer

					---
					## 1. Adicionando um botão para apagar
						{% for afazer in afazeres %}
							<hr> <!-- Cria linha horizontal -->
							<div style="display: flex; justify-content: space-between;">
								<span>{{ afazer.conteudo }}</span>
								<form action="apagar/{{ afazer.id }}" method="POST">
									<button type="submit">Apagar</button>
								</form>
							</div>
						{% endfor %}
					
					---
					<!-- .slide: data-transition-background='zoom-in' data-transition="zoom-in fade-out" -->
					## 2. Criando uma rota para apagar o afazer
						@app.route('/apagar/<int:id>', methods=['POST'])
						def apagar_afazer(id):
							consulta(f'DELETE FROM afazeres WHERE id = {id}')
							return redirect('/')

					---
					<!-- .slide: data-transition-background='convex-in zoom-out' data-transition="convex-in zoom-out" -->
					## Editando (Update) com Python Flask 
					1. Fazer um link para editar o afazer
					1. Criar um formulário para editar o afazer
					2. Criar uma rota para editar o afazer

					---
					## 1. Fazer um link para editar o afazer
						{% for afazer in afazeres %}
							<hr> <!-- Cria linha horizontal -->
							<div style="display: flex; justify-content: space-between;">
								<span>{{ afazer.conteudo }}</span>
								<div>
								    <a href="editar/{{ afazer.id }}">Editar</a>
								    <!-- Manter o botão de apagar -->
							    </div>
							</div>
						{% endfor %}


					---
					## 2. Adicionando um formulário para editar o afazer
						<h1>Editar o afazer:</h1>
						<form method="POST" action="/editar/{{ afazer.id }}">
							<input type="text" name="conteudo" value="{{ afazer.conteudo }}">
							<button type="submit">Editar</button>
						</form>

					---
					<!-- .slide: data-transition-background='zoom-in' data-transition="zoom-in fade-out" -->
					## 3 . Criando uma rota para editar o afazer
						@app.route('/editar/<int:id>', methods=['POST'])
						def editar_afazer(id):
							conteudo = request.form['conteudo']
							consulta(f'UPDATE afazeres SET conteudo = "{conteudo}" WHERE id = {id}')
							return redirect('/')
					
					---
					<!-- .slide: data-transition-background='concave-in zoom-out' data-transition="concave-in zoom-out" -->
					# Bons estudos!
					
					</textarea>

				</section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script src="plugin/zoom/zoom.js"></script>
		
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				theme:'dracula',
				transition:'zoom',
				backgroundTransition: 'zoom',

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom ] 
			});
			let line = null;

			Reveal.on('fragmentshown', (event) => {
				console.log(event);
				if (event.fragment.id === 'start-highlight') {
					if (line === null) {
						line = new LeaderLine(
							document.getElementById('start-highlight'),
							document.getElementById('end-highlight'),
							{
								color: '#359830', path: 'arc',
							hide: true,
						}
						);
					}
					line.show('draw', {
							duration: 500,
							timing: [0.58, 0, 0.42, 1],
							loop: true
						});
					
				console.log(line);
				}
});
			Reveal.on('fragmenthidden', (event) => {
				if (event.fragment.id === 'start-highlight') {
					line.hide('draw');
				}
			});

			Reveal.on('slidechanged', (event) => {
				if (line !== null) {
					line.remove();
					line = null;
				}
			});

			
		</script>
	</body>
</html>

